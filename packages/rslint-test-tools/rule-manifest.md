# Rule Manifest Specification

This document describes the requirements and conventions for generating and maintaining the `rule-manifest.json` file in the `rslint` project.

## Purpose

The `rule-manifest.json` file provides a machine-readable manifest of all implemented rules, their implementation and test status, and failing test cases (if any). It is used for tracking rule coverage, CI automation, and reporting.

## Generation

- The manifest is automatically generated by the script `scripts/gen-rule-manifest.js`.
- The script scans all rule directories under `internal/rules/`.
- It checks the test inclusion and skip status from `packages/rslint-test-tools/rstest.config.mts` and test files under `packages/rslint-test-tools/tests/typescript-eslint/rules/`.
- The manifest is output to `packages/rslint-test-tools/rule-manifest.json`.

## Format

```json
{
  "rules": [
    {
      "name": "array_type",
      "status": "full" | "partial-impl" | "partial-test" | "none",
      "failing_case": [
        { "name": "caseName", "url": "relative/path/to/test.ts#L123" }
      ]
    },
    // ...
  ]
}
```

### Fields

- `name`: Rule name (directory name under `internal/rules/`)
- `status`:
  - `full`: Implementation and tests are complete (Go/JS side all pass, no skipped cases)
  - `partial-impl`: Implementation or test is incomplete, or there are skipped/known failing cases (see `failing_case`)
  - `partial-test`: Only Go-side tests exist, or the rule is not included in the JS test config
  - `none`: Not implemented, no tests
- `failing_case`: For `partial-impl` rules, an array of objects with:
  - `name`: The name/description of the skipped or failing test case
  - `url`: Relative path to the test file with line number (e.g., `packages/rslint-test-tools/tests/typescript-eslint/rules/array-type.test.ts#L1998`)
- `group`: The rule's source group. If the rule directory exists in `internal/plugins/<group>/<rule>`, then `<group>` is used. Otherwise, the default is `typescript-eslint`.

## Status Determination Logic

- If a rule is not included in the `include` list of `rstest.config.mts`, its status is `partial-test`.
- If a rule is included but has any skipped test cases (e.g., `describe.skip`, `it.skip`, or `{ skip: true, name: ... }`), its status is `partial-impl`, and all such cases are listed in `failing_case`.
- If a rule is included and has no skipped cases, its status is `full`.
- If a rule is not implemented or has no tests, its status is `none`.

## Automation

- The manifest is automatically updated by a GitHub Action on PR merge if any rule is added or removed.
- To manually update, run:
  ```sh
  node scripts/gen-rule-manifest.js
  ```

## Example

```json
{
  "rules": [
    {
      "name": "array_type",
      "status": "partial-impl",
      "failing_case": [
        {
          "name": "array-type (nested)",
          "url": "packages/rslint-test-tools/tests/typescript-eslint/rules/array-type.test.ts#L1998"
        },
        {
          "name": "schema validation",
          "url": "packages/rslint-test-tools/tests/typescript-eslint/rules/array-type.test.ts#L2234"
        }
      ]
    },
    {
      "name": "no_array_delete",
      "status": "full",
      "failing_case": []
    }
  ]
}
```

## Maintenance

- Update the script if the rule/test directory structure changes.
- Ensure all new rules and tests follow the naming conventions for correct manifest generation.
- For any skipped or known failing test cases, use `describe.skip`, `it.skip`, or `{ skip: true, name: '...' }` with a descriptive name for accurate reporting.
